<html>
<head>
    <meta charset="utf-8">
    <title>Free登录</title>
    <link rel="icon" href="./static/resources/image/favicon.ico" type="image/x-icon">
</head>
<body background="../static/resources/image/1.jpg">
<h1>欢迎访问Free :)</h1>

<div class="login" style="margin-top:50px;">

    <div class="header">
        <div class="switch" id="switch"><a class="switch_btn_focus" id="switch_qlogin" href="javascript:void(0);"
                                           tabindex="7">快速登录</a>
            <a class="switch_btn" id="switch_login" href="javascript:void(0);" tabindex="8">快速注册</a>
            <div class="switch_bottom" id="switch_bottom" style="position: absolute; width: 64px; left: 0px;"></div>
        </div>
    </div>


    <div class="web_qr_login" id="web_qr_login" style="display: block; height: 235px;">

        <!--登录-->
        <div class="web_login" id="web_login">


            <div class="login-box">


                <div class="login_form">
                    <form action="/user/login" name="loginform" accept-charset="utf-8" id="login_form" class="loginForm"
                          method="post"><input type="hidden" name="did" value="0"/>
                        <div class="uinArea" id="uinArea">
                            <label class="input-tips" for="username">名称：</label>
                            <div class="inputOuter" id="uArea">

                                <input type="text" id="username" name="name" class="inputstyle"/>
                            </div>
                        </div>
                        <div class="pwdArea" id="pwdArea">
                            <label class="input-tips" for="password">密码：</label>
                            <div class="inputOuter" id="pArea">

                                <input type="password" id="password" name="password" class="inputstyle"/>
                            </div>
                        </div>

                        <div style="padding-left:50px;margin-top:20px;">
                            <input id="loginBtn" type="button" value="登 录" style="width:150px;" class="button_blue"/>
                        </div>
                    </form>
                </div>

            </div>

        </div>
        <!--登录end-->
    </div>

    <!--注册-->
    <div class="qlogin" id="qlogin" style="display: none; ">

        <div class="web_login">
            <form name="form2" id="regUser" accept-charset="utf-8" action="" method="post">
                <ul class="reg_form" id="reg-ul">
                    <div id="userCue" class="cue">欢迎注册Free！</div>
                    <li>

                        <label for="user" class="input-tips2">名称：</label>
                        <div class="inputOuter2">
                            <input type="text" id="user" name="user" maxlength="16" class="inputstyle2"/>
                        </div>

                    </li>

                    <li>
                        <label for="passwd" class="input-tips2">密码：</label>
                        <div class="inputOuter2">
                            <input type="password" id="passwd" name="pwd" maxlength="16" class="inputstyle2"/>
                        </div>

                    </li>
                    <li>
                        <label for="passwd2" class="input-tips2">确认密码：</label>
                        <div class="inputOuter2">
                            <input type="password" id="passwd2" name="" maxlength="16" class="inputstyle2"/>
                        </div>

                    </li>

                    <li>
                        <div class="inputArea">
                            <input type="button" id="reg" style="margin-top:10px;margin-left:85px;" class="button_blue"
                                   value="注册"/>
                        </div>

                    </li>
                    <div class="cl"></div>
                </ul>
            </form>


        </div>


    </div>
    <!--注册end-->
</div>
<div class="jianyi">推荐使用Chrome内核浏览器访问本站</div>

<!-- jQuery 3 -->
<script src="../static/bower_components/jquery/dist/jquery.min.js"></script>
<script src="../static/plugins/sweetalert/sweetalert.min.js"></script>
<link rel="stylesheet" type="text/css" href="../static/plugins/sweetalert/sweetalert.css">
<!--<script type="text/javascript" src="../static/resources/js/login.js?v=20175131017 "></script>-->
<link href="../static/resources/css/login.css" rel="stylesheet" type="text/css"/>


<script>
    /**
     * 登录按钮点击事件
     */
    $("#loginBtn").click(function () {
        console.log("into click loginBtn");
        var username = $("#username").val().trim();
        var password = $("#password").val().trim();
        console.log(username+password);
        if (username.length == 0 || password.length == 0) {
            sweetAlert("用户名或密码为空，请填写！", "error");
            return;
        }
        $.ajax({
            type: "post",
            url: "/user/userlogin",
            data:
                {
                "userName": username,
                "password": password
                },
            success: function (data) {
                console.log(data);
                var code = data.code;
                if (code==0) {
                    console.log("登录成功");
                    // $("#login_form").submit();
                    window.location.replace("/user/logintest");
                } else {

                    if (code == 10) {
                        sweetAlert("出错了","用户名或密码错误", "error");
                        return;
                    } else {
                        sweetAlert("出错了","服务器出现未知错误~", "error");
                        return;
                    }
                }
            }
        });
    });


    /**
     * 用户名输入框失去焦点事件，ajax判断是否该名称已经被注册
     */
    $("#user").blur(function () {
        var userName = $("#user").val().trim();
        var sendData = JSON.stringify({'userName': userName});
        console.log(sendData);
        if (userName.length != 0) {
            /**
             * 返回data类型
             * {successed ： true | false} 注册是否成功
             * {errStatus : 1  } 用户名已经被注册

             */
            $.ajax({
                type: "POST",
                url: "/user/register",
                data: {
                    "userName":userName
                },
                success: function (data) {
                    console.log(data);
                    var code=data.code;
                    if (code==0) {
                        $('#user').css({
                            border: "1px solid #D7D7D7",
                            boxShadow: "none"
                        });
                        $("#userCue").html("欢迎注册EastChat！");
                    }else if(code == 11){
                        $('#user').focus().css({
                            border: "1px solid red",
                            boxShadow: "0 0 2px red"
                        });
                        $('#userCue').html("<font color='red'><b>该用户名已经被注册！</b></font>");
                    }
                }
            })
        }
        $('#user').css({
            border: "1px solid #D7D7D7",
            boxShadow: "none"
        });
        $("#userCue").html("欢迎注册Free！");
    });

    /**
     * 注册按钮点击事件
     */
    $("#reg").click(function () {
        var userName = $("#user").val().trim();
        var pwd1 = $("#passwd").val().trim();
        var pwd2 = $("#passwd2").val().trim();
        if (userName.length == 0 || pwd1.length == 0 || pwd2.length == 0){
            sweetAlert("出错了", "您还有些内容未填写~", "error");
            return;
        }else if (pwd1 != pwd2){
            sweetAlert("出错了", "两次密码输入不一致，请重新填写~", "error");
        }else {
            var sendData = JSON.stringify({"userName" : userName, "password": pwd1});
            $.ajax({
                type: "POST",
                url: "/user/register",
                data: {
                    "userName":userName,
                    "password":pwd1
                },
                success : function (data) {
                    if (data.code==0){
                        sweetAlert("注册成功啦！", "快去登录~加入聊天吧~", "success");
                    }else {
                        sweetAlert("出错了", "注册失败，请再次尝试~", "error");
                    }
                }
            });
        }

    });
    $('#switch_qlogin').click(function () {
        $('#switch_login').removeClass("switch_btn_focus").addClass('switch_btn');
        $('#switch_qlogin').removeClass("switch_btn").addClass('switch_btn_focus');
        $('#switch_bottom').animate({left: '0px', width: '70px'});
        $('#qlogin').css('display', 'none');
        $('#web_qr_login').css('display', 'block');

    });
    $('#switch_login').click(function () {

        $('#switch_login').removeClass("switch_btn").addClass('switch_btn_focus');
        $('#switch_qlogin').removeClass("switch_btn_focus").addClass('switch_btn');
        $('#switch_bottom').animate({left: '154px', width: '70px'});

        $('#qlogin').css('display', 'block');
        $('#web_qr_login').css('display', 'none');
    });
    if (getParam("a") == '0') {
        $('#switch_login').trigger('click');
    }

    function logintab() {
        scrollTo(0);
        $('#switch_qlogin').removeClass("switch_btn_focus").addClass('switch_btn');
        $('#switch_login').removeClass("switch_btn").addClass('switch_btn_focus');
        $('#switch_bottom').animate({left: '154px', width: '96px'});
        $('#qlogin').css('display', 'none');
        $('#web_qr_login').css('display', 'block');

    }
</script>
</body>
</html>