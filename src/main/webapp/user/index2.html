<!DOCTYPE html>
<html lang="en" xmlns:a="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>哔狗Free</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../tempcss/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../tempcss/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="../tempcss/layui/css/layui.css">
    <link rel="stylesheet" href="../tempcss/bilibili/bilibili.css">
</head>
<body>
<svg aria-hidden="true" style="width: 0px;height: 0px;overflow:hidden; position: absolute"></svg>
<!--我来组成头部！！！！ -->
<li class="layui-lump" id="head">
    <ul class="layui-nav">
        <li class="layui-nav-logo">
            <a href="index2.html"><i class="layui-icon layui-icon-website" style="font-size: 15px"></i>FREE</a>
        </li>

        <li style="float: right" class="layui-nav-item">
            <a href="">退出</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href="">历史记录</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href="">消息</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href=""><img class="layui-nav-img" src="//t.cn/RCzsdCq">哔了狗了</a>
        </li>


        <div class="bili-header-m">
            <li style="float: right;height: 15px;right: -30px" class="layui-nav-item">
                <div class="search" id="search">
                    <form class="searchform"  method="post">
                        <input id="searchcomment" class="search-keyword" accesskey="s" type="text"
                                                    placeholder="搜索内容" value=""
                                                     x-webkit-grammar="builtin:translate" x-webkit-speech=""
                                                    autocomplete="off">
                        <button class="search-submit" type="button" onclick="Search()" ></button>
                    </form>

                </div>
            </li>
        </div>

        </li>


    </ul>
</li>


<!--类别-->
<div class="bili-wrapper">
    <div class="primary-menu report-wrap-module report-scroll-module " id="primary_menu" scrollshow="true">
        <ul class="nav-menu" id="sort1">

            <li><a href="">
                <div class="num-wrap"><span>999+</span></div>
                <div class="nav-name">动画</div>
            </a></li>

            </li>
        </ul>
    </div>
</div>

<!--展示-->
<div class="up clearfix" id="display">

    <!--各分区-->
    <div class="bili-wrapper" >
        <div class="zone-wrap-module report-wrap-module report-scroll-module clearfix"
             scrollshow="true">
            <div class="zone-module">
                <!--展示栏-->
                <div class="new-comers-module l-con" id="i_head">
                    <div class="zone-title">
                        <div class="headline clearfix "><a class="name" href="sort.html">动画</a>
                            <div class="bili-tab bili-tab">

                                <div class="bili-tab-item"><a  href="www.baidu.com">最新投稿</a></div>
                            </div>
                            <a class="link-more" href="/v/douga" target="_blank">
                                更多
                                <i class="icon"></i></a>
                            <div class="read-push"><span class="info"><b>41241</b>条周更新</span>
                            </div>
                        </div>
                    </div>
                    <div class="storey-box clearfix" id="introduce1">

                        <!--各视频介绍-->


                    </div>
                </div>
                <!--分区排行-->

            </div>
        </div>
    </div>

    <div class="bili-wrapper">
        <div class="zone-wrap-module report-wrap-module report-scroll-module clearfix" id="free_fanju"
             scrollshow="true">
            <div class="zone-module">
                <!--展示栏-->
                <div class="new-comers-module l-con">
                    <div class="zone-title">
                        <div class="headline clearfix "><a class="name" href="/v/douga">番剧</a>
                            <div class="bili-tab bili-tab">

                                <div class="bili-tab-item"><a  href="www.baidu.com">最新投稿</a></div>
                            </div>
                            <a class="link-more" href="/v/douga" target="_blank">
                                更多
                                <i class="icon"></i></a>
                            <div class="read-push"><span class="info"><b>41241</b>条新动态</span>
                            </div>
                        </div>
                    </div>
                    <div class="storey-box clearfix">

                    </div>
                </div>
                <!--分区排行-->

            </div>
        </div>
    </div>



</div>
<!--底部-->
<div style="padding-top: 50px">
<footer class="main-bottom">
    <div class="pull-right hidden-xs">
        <b>Version</b> 1.1.0
    </div>
    <strong>Copyright &copy; 2014-2016 <a href="">Almsaeed Studio</a>.</strong>
   工程实践IV
</footer>
</div>
<!--返回顶部-->
<div class="report-wrap-module elevator-module" style="bottom: 0px;">
    <div class="nav-bg">
    </div>

        <button  class="back-top icon " onclick="topFunction()" id="myBtn" title="返回顶部">
            <div class="top-blank"></div></button>
    <div class="top-blank"></div>

</div>

<script src="../static/bower_components/jquery/dist/jquery.min.js"></script>

<script src="../static/layui/layui.js" charset="utf-8"></script>

<script src="../static/bower_components/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script>
    layui.use('element', function () {
        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

        //监听导航点击
        element.on('nav(demo)', function (elem) {
            //console.log(elem)
            layer.msg(elem.text());
        });
    });
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
</script>

<script language="JavaScript">
    function Search() {
        var videoName=$("#searchcomment").val();
        window.location.href="/user/searchresult.html?VideoName="+videoName;
    }

</script>
<script>
    var userId = $.cookie('userId');

    $(function () {
        showAllSort();
        getUserInfo(userId);

    });

    /**
     *获得当前登录用户的用户信息
     */
    function getUserInfo(userId) {
        var result;
        $.ajax({
            url: '/user/getUserInfo',
            type: 'get',
            data: {
                userId: userId
            },
            success: function (data) {
                if (data.code == 0) {
                    result = data.data;
                    showhead(result);
                }
            }
        });
    };
    //导航栏
    function showhead(data){
        $("#head").empty();
        var appendhtml='';
        var user=data;
        appendhtml+=' <ul class="layui-nav">\n' +
            '        <li class="layui-nav-logo">\n' +
            '            <a href="index2.html"><i class="layui-icon layui-icon-website" style="font-size: 15px"></i>FREE</a>\n' +
            '        </li>\n' +
            '\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="/user/login.html">退出</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="">历史记录</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
    '            <a href="/user/news.html">消息</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="/user/personcenter.html"><img class="layui-nav-img" src="..'+user.icon+'">'+user.userName+'</a>\n' +
            '        </li>\n' +
            '\n' +
            '\n' +
            '        <div class="bili-header-m">\n' +
            '            <li style="float: right;height: 15px;right: -30px" class="layui-nav-item">\n' +
            '                <div class="search" id="search">\n' +
            '                    <form class="searchform"  method="post">\n' +
            '                        <input id="searchcomment" class="search-keyword" accesskey="s" type="text"\n' +
            '                                                    placeholder="搜索内容" value=""\n' +
            '                                                     x-webkit-grammar="builtin:translate" x-webkit-speech=""\n' +
            '                                                    autocomplete="off">\n' +
            '                        <button class="search-submit" type="button" onclick="Search()" ></button>\n' +
            '                    </form>\n' +
            '\n' +
            '                </div>\n' +
            '            </li>\n' +
            '        </div>\n' +
            '\n' +
            '        </li>\n' +
            '\n' +
            '\n' +
            '    </ul>';
        $("#head").append(appendhtml);
    }

    $.ajax({
        url: "/video/getAllVideo",
        type: "get",
        dataType: "json",
        success: function (data) {
            console.log(data.data);
            var types=[];
            var typess=[];
            for (var i=0;i<data.data.length;i++){
                types[i]=data.data[i].typeId;
                types.push(types[i]);
            }
            for(var i=0;i<types.length;i++){
                if(typess.indexOf(types[i])<0){
                    typess.push(types[i])
                }
            }
            //alert(typess.length);

            showAllvideo(data,typess);

        }
    });

        //获取各分区视频数量
   function getAllCount(){
       var allcount;
       $.ajax({
           url: '/video/getAllCount',
           type: 'get',
           dataType:'json',
           async: false,
           success:function (data) {
               if(data.code==0){
                   allcount=data.data;
               }
               //showAllSort(allcount);
           }
       });
       return allcount;
   }
        //根据id获取类型名
    function getTypeName(typeId) {
        var typename;
        $.ajax({
            url: '/video/getTypeName',
            type: 'get',
            dataType: 'json',
            data: {
                typeId: typeId
            },
            async: false,
            success: function (data) {
                if (data.code == 0) {
                    typename = data.data;
                }
            }
        });
        return typename;
    }
    //获取所有分区
    function getAllType() {
        var type;
        $.ajax({
            url:'/video/getAllType',
            type:'get',
            dataType:'json',
            async:false,
            success:function (Type) {
                if (Type.code == 0) {
                    type = Type.data;
                }
            }
        });
        return type;

    }
    //各分区排行榜
    function getVideoRank(typeId){
        var ranks;
        $.ajax({
            url:'/video/getVideoRank',
            type:'get',
            dataType:'json',
            data:{
                typeId:typeId
            },
            async:false,
            success:function(rank){
                if(rank.code==0){
                    ranks=rank.data;
                }
            }

        });
        return ranks;
    }




    //显示分区个视频数量
    function showAllSort(){
        $("#sort1").empty();
        var appendhtml='';
        var counts=[];
        var type=[];
        counts=getAllCount();//调用获取分区内视频数的function
        type=getAllType();//调用获取分区类型的function

        for(var i=0;i<type.length;i++){
            appendhtml +='<li><a href="/user/sort.html?sortId='+type[i].id+'">\n' +
                '                <div class="num-wrap"><span>'+counts[i]+'</span></div>\n' +
                '                <div class="nav-name">'+type[i].name+'</div>\n' +
                '            </a></li>';
        }
        $("#sort1").append(appendhtml);

    }
    function getUpdateCount(typeId) {
       var count;
       $.ajax({
           url:'/video/getUpdateCount',
           type:'get',
           dataType:'json',
           data:{
               typeId:typeId
           },
           async:false,
           success:function(data) {
               if (data.code == 0) {
                   count = data.data;
               }
           }
       });
       return count;

    }

    /**
     * 显示首页主要内容
     * @param data
     * @param typess
     */
    function showAllvideo(data,typess) {
        $("#display").empty();
        console.log("第一次：" + data.data.length);
        var appendhtml='';
        var type=[];
        var ranks=[];
        type=getAllType();//获取全部分区类型
        for(var i=0;i<type.length;i++) {
            ranks=getVideoRank(type[i].id);
            var count=getUpdateCount(type[i].id);
             appendhtml +='<div class="bili-wrapper" >\n' +
                 '        <div class="zone-wrap-module report-wrap-module report-scroll-module clearfix"\n' +
                 '             scrollshow="true">\n' +
                 '            <div class="zone-module">\n' +
                 '                <!--展示栏-->\n' +
                 '                <div class="new-comers-module l-con">\n' +
                 '                    <div class="zone-title">\n' +
                 '                        <div class="headline clearfix "><a class="name" href="/user/sort.html?sortId='+type[i].id+'">'+type[i].name+'<!--分区名称--></a>\n' +
                 '                            <div class="bili-tab bili-tab">\n' +
                 '\n' +
                 '                                <div class="bili-tab-item">最新投稿</div>\n' +
                 '                            </div>\n' +
                 '                            <a class="link-more" href="/user/sort.html?sortId='+type[i].id+'" target="_blank">\n' +
                 '                                更多\n' +
                 '                                <i class="icon"></i></a>\n' +
                 '                            <div class="read-push"><span class="info"><b>'+count+'</b>条日更新</span>\n' +
                 '                            </div>\n' +
                 '                        </div>\n' +
                 '                    </div>\n' +
                 '                    <div class="storey-box clearfix">\n' ;

                  for(var j=0;j<data.data.length;j++) {
                      if(data.data[j].typeId==type[i].id) {
                          appendhtml += '<div class="spread-module" >' +
                              '<a href="/user/video.html?videoId=' + data.data[j].id + '" target="_blank">\n' +
                              '            <div class="pic">\n' +
                              '            <div class="lazy-img"><img alt=""\n' +
                              '        src="..' + data.data[j].firstImagePath + '">\n' +
                              '            </div>\n' +
                              '\n' +
                              '            <div class="mask-video"></div>\n' +
                              '            <span class="dur"><p>' + data.data[j].videoLength + '</p></span><!--播放时长-->\n' +
                              '        <div class="watch-later-trigger w-later"></div>\n' +
                              '            </div>\n' +
                              '            <p title="' + data.data[i].name + '" class="t">' + data.data[j].name + '</p>\n' +
                              '            <p class="num"><span class="play"><i class="icon"></i><!--播放量-->' + data.data[j].vv + '</span>\n' +
                              '        <span class="danmu"><i class="icon"></i>' + data.data[j].commentCount + '</span><!--评论数-->\n' +
                              '        </p></a>' +
                              '</div>';}
                  }
                           appendhtml +='</div>';
                           appendhtml +='</div>';

                           appendhtml +=' <!--分区排行-->\n' +
                          '                <section class="sec-rank report-wrap-module zone-rank">\n' +
                          '                    <header class="rank-head"><h3>排行</h3>\n' +
                          '                        <div class="bili-tab rank-tab">\n' +
                          '                        </div>\n' +
                          '                    </header>\n' +
                          '                    <div class="rank-list-wrap">\n' +
                          '                        <ul class="rank-list hot-list"><!---->\n' ;
                           var count=1;
                           for(var k=0;k<ranks.length;k++){
                                   if(count<=7) {
                                       appendhtml +=
                                           '<li class="rank-item"><i class="ri-num">' + count+ '</i><a class="ri-info-wrap clearfix"\n' +
                                           '           href="/user/video.html?videoId='+ranks[k].id+'" target="_blank">\n' +
                                           '    <div class="ri-detail"><p class="ri-title">' + ranks[k].name + '</p>\n' +
                                           '        <p class="ri-point">播放量：' + ranks[k].vv + '</p></div><!----></a></li>';
                                   }
                                  count=count+1;
                           }
                                       appendhtml +='</ul>\n' +
                                       '                        <ul class="rank-list origin-list">\n' +
                                       '                            <li class="state">\n' +
                                       '                                <div class="b-loading"><!----><!----></div>\n' +
                                       '                            </li>\n' ;
                                   appendhtml +=' </ul>\n' +
                                       '                    </div>\n' +
                                       '                    <a class="more-link" href="/user/sort.html?sortId='+type[i].id+'" target="_blank">查看更多<i\n' +
                                       '                            class="icon icon-arrow-r"></i></a>\n';

                            appendhtml +='</section>';
            appendhtml +='</div>';
            appendhtml +='</div>';

                   }
            $("#display").append(appendhtml);
                  }


</script>

</body>
</html>