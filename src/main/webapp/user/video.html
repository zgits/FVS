<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="../static/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../static/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="../static/bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../static/dist/css/AdminLTE.min.css">

    <link rel="stylesheet" href="../static/plugins/sweetalert/sweetalert.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="../static/dist/css/skins/_all-skins.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="../static/dist/js/html5shiv.min.js"></script>
    <script src="../static/dist/js/respond.min.js"></script>
    <![endif]-->

    <!-- Google Font -->
    <!--    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">-->
    <link href="../src/css/scojs.css" rel="stylesheet">
    <link href="../src/css/colpick.css" rel="stylesheet">
    <link href="../src/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="../src/css/main.css">
    <!--<link rel="stylesheet" href="../dist/css/danmuplayer.css">-->


    <link rel="stylesheet" href="../tempcss/layui/css/layui.css">
    <link rel="stylesheet" href="../tempcss/bilibili/bilibili.css">

    <style>
        .colorflag {
            color: #fc9521;
        }
        #introduce::before{
            display: block;
            width: 7em;
            content:"视频简介";
            padding:1px 5px;
            margin: 10px 0 10px -20px;
            border-bottom:1px solid #f4f4f4;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            text-indent: 0;
            color:#444;
            font-weight: 500;

        }
        #introduce {
            margin: 0 0 20px 0;
            padding: 0 0 15px 40px;
            color:#999;
            border-bottom: 1px solid #f4f4f4;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<li class="layui-lump" id="head">
    <ul class="layui-nav">
        <li class="layui-nav-logo">
            <a href="index2.html"><i class="layui-icon layui-icon-website" style="font-size: 15px"></i>FREE</a>
        </li>

        <li style="float: right" class="layui-nav-item">
            <a href="">退出</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href="">历史记录</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href="">消息</a>
        </li>
        <li style="float: right" class="layui-nav-item">
            <a href=""><img class="layui-nav-img" src="//t.cn/RCzsdCq">哔了狗了</a>
        </li>


        <div class="bili-header-m">
            <li style="float: right;height: 15px;right: -30px" class="layui-nav-item">
                <div class="search" id="search">
                    <form class="searchform"  method="post">
                        <input id="searchcomment" class="search-keyword" accesskey="s" type="text"
                               placeholder="搜索内容" value=""
                               x-webkit-grammar="builtin:translate" x-webkit-speech=""
                               autocomplete="off">
                        <button class="search-submit" type="button" onclick="Search()" ></button>
                    </form>

                </div>
            </li>
        </div>

        </li>


    </ul>
</li>

<section class="content">
    <div class="row col-md-offset-2">
        <div class="col-md-6">
            <!-- Box Comment -->
            <div class="box box-widget">
                <div class="box-header with-border">
                    <div class="user-block" id="userInfo">
                        <img class="img-circle" src="../static/dist/img/user1-128x128.jpg" alt="User Image">
                        <span class="username"><a href="#">用户名</a>
                            <button type="button" class="btn btn-default btn-xs"> 关注</button>
                        </span>

                        <span class="description">分区 2019-06-06 14:13:12</span>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div id="danmup"></div>


                    <p id="introduce">视频的简介</p>

                    <div class="row">
                        <div class="col-md-4 col-sm-6 col-xs-12">
                            <div class="info-box bg-green" onclick="giveVideoCollection()" style="cursor: pointer">
                                <span class="info-box-icon "><i class="fa fa-star-o"></i></span>

                                <div class="info-box-content">
                                    <span class="info-box-text">收藏</span>
                                    <span class="info-box-number" id="videoCollectionNumber">93139</span>
                                </div>
                                <!-- /.info-box-content -->
                            </div>
                            <!-- /.info-box -->
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-12">
                            <div class="info-box bg-yellow" onclick="giveVideoPraise()" style="cursor: pointer">
                                <span class="info-box-icon"><i class="fa fa-thumbs-o-up"></i></span>

                                <div class="info-box-content">
                                    <span class="info-box-text">点赞</span>
                                    <span class="info-box-number" id="videoPraiseNumber">41410</span>

                                </div>
                                <!-- /.info-box-content -->
                            </div>
                            <!-- /.info-box -->
                        </div>

                    </div>

                </div>
                <!-- /.box-body -->


                <div class="box-footer box-comments" style="background-color: white" id="videoComment">

                    <div class="box-comment">
                        <!-- User image -->
                        <img class="img-circle img-sm" src="../static/dist/img/user3-128x128.jpg" alt="User Image">

                        <div class="comment-text">
                      <span class="username">
                        Maria Gonzales
                        <span class="text-muted pull-right">8:03 PM Today</span>
                      </span><!-- /.username -->
                            It is a long established fact that a reader will be distracted
                            by the readable content of a page when looking at its layout.
                        </div>
                        <!-- /.comment-text -->
                    </div>
                    <!-- /.box-comment -->
                    <div class="box-comment">

                        <!-- User image -->
                        <img class="img-circle img-sm" src="../static/dist/img/user4-128x128.jpg" alt="User Image">

                        <div class="comment-text">
                                 <span class="username">
                                  Luna Stark
                                   <span class="text-muted pull-right">8:03 PM Today</span>
                                 </span><!-- /.username -->
                            It is a long established fact that a reader will be distracted
                            by the readable content of a page when looking at its layout.
                            <button class="btn btn-success btn-xs pull-right">回复</button>
                            <a class="pull-right" data-toggle="collapse" href="#collapseThree">查看回复</a>
                        </div>

                        <div id="collapseThree" class="panel-collapse collapse">
                        </div>
                        <!-- /.comment-text -->
                    </div>
                    <!-- /.box-comment -->
                </div>
                <!-- /.box-footer -->
                <div class="box-footer" id="inputComment">

                </div>
                <!-- /.box-footer -->
            </div>


            <div class="row">
                <div class="col-sm-3">
                    <div class="dataTables_info center-block" id="example2_info" role="status" aria-live="polite"></div>
                </div>
                <div class="col-sm-7">
                    <div class="dataTables_paginate paging_simple_numbers" id="example2_paginate">
                        <ul class="pagination" id="page">
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /.box -->
        </div>
        <!-- /.col -->

        <div class="col-md-4 col-md-offset-1">
            <div class="box-header with-border">
                <div class="user-block">
                    <span class="username">相关推荐</span>
                    <span class="description">&nbsp;</span>
                </div>
            </div>
            <div class="box-body" id="sameVideo">
                <div class="info-box">
                    <div class="attachment-block clearfix">
                        <img class="attachment-img" src="../static/dist/img/photo1.png" alt="Attachment Image">

                        <div class="attachment-pushed">
                            <h4 class="attachment-heading"><a href="http://www.lipsum.com/">视频的简介</a></h4>

                            <div class="attachment-text">
                                上传者
                            </div>
                            <!-- /.attachment-text -->
                        </div>
                        <!-- /.attachment-pushed -->
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <div class="info-box">
                    <div class="attachment-block clearfix">
                        <img class="attachment-img" src="../static/dist/img/photo1.png" alt="Attachment Image">

                        <div class="attachment-pushed">
                            <h4 class="attachment-heading"><a href="http://www.lipsum.com/">Lorem ipsum text
                                generator</a></h4>

                            <div class="attachment-text">
                                Description about the attachment can be placed here.
                                Lorem Ipsum is simply dummy text of the printing and typesetting industry... <a
                                    href="#">more</a>
                            </div>
                            <!-- /.attachment-text -->
                        </div>
                        <!-- /.attachment-pushed -->
                    </div>
                    <!-- /.info-box-content -->
                </div>
            </div>
        </div>
    </div>


</section>

<!-- /.row -->


<!-- jQuery 3 -->
<script src="../static/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../static/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!--cookie-->
<script src="../static/plugins/cookie/jquery.cookie.min.js"></script>

<script src="../src/js/jquery.shCircleLoader.js"></script>
<script src="../src/js/sco.tooltip.js"></script>
<script src="../src/js/colpick.js"></script>
<script src="../src/js/jquery.danmu.js"></script>
<script src="../src/js/main.js"></script>

<!-- Slimscroll -->
<script src="../static/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../static/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../static/dist/js/adminlte.min.js"></script>

<script src="../static/layui/layui.js" charset="utf-8"></script>

<script src="../static/plugins/sweetalert/sweetalert.min.js"></script>

<script src="../static/tools.js"></script>

<script>

    var userId = $.cookie('userId');

    var videoId = getUrlParam("videoId");

    var VUserId;


    $(function () {
        getVideoInfo(videoId);
        getUserInfo1(userId);
        updateVideovv();
    })


    /**
     *获得当前登录用户的用户信息
     */
    function getUserInfo1(userId) {
        var result;
        $.ajax({
            url: '/user/getUserInfo',
            type: 'get',
            data: {
                userId: userId
            },
            success: function (data) {
                if (data.code == 0) {
                    result = data.data;
                    showhead(result);
                }
            }
        });
    };

    function showhead(data){
        $("#head").empty();
        var appendhtml='';
        var user=data;
        appendhtml+=' <ul class="layui-nav">\n' +
            '        <li class="layui-nav-logo">\n' +
            '            <a href="index2.html"><i class="layui-icon layui-icon-website" style="font-size: 15px"></i>FREE</a>\n' +
            '        </li>\n' +
            '\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="/user/login.html">退出</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="">历史记录</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href="/user/news.html">消息</a>\n' +
            '        </li>\n' +
            '        <li style="float: right" class="layui-nav-item">\n' +
            '            <a href=""><img class="layui-nav-img" src="..'+user.icon+'">'+user.userName+'</a>\n' +
            '        </li>\n' +
            '\n' +
            '\n' +
            '        <div class="bili-header-m">\n' +
            '            <li style="float: right;height: 15px;right: -30px" class="layui-nav-item">\n' +
            '                <div class="search" id="search">\n' +
            '                    <form class="searchform"  method="post">\n' +
            '                        <input id="searchcomment" class="search-keyword" accesskey="s" type="text"\n' +
            '                                                    placeholder="搜索内容" value=""\n' +
            '                                                     x-webkit-grammar="builtin:translate" x-webkit-speech=""\n' +
            '                                                    autocomplete="off">\n' +
            '                        <button class="search-submit" type="button" onclick="Search()" ></button>\n' +
            '                    </form>\n' +
            '\n' +
            '                </div>\n' +
            '            </li>\n' +
            '        </div>\n' +
            '\n' +
            '        </li>\n' +
            '\n' +
            '\n' +
            '    </ul>';
        $("#head").append(appendhtml);
    }


    function updateVideovv() {
        $.ajax({
            url: '/video/updateVideovv/' + videoId,
            type: 'patch',
            success: function (data) {
                // alert(data);
            }
        })
    }


    /**
     * 根据videoId获取video信息
     * @param videoId
     */
    function getVideoInfo(videoId) {
        $.ajax({
            url: '/video/getVideo',
            type: 'get',
            data: {
                id: videoId
            },
            success: function (data) {
                if (data.code == 0 && data.data != null) {
                    var videoVo = data.data;
                    var video = videoVo.video;
                    var videoUserId = video.userId;
                    var focus = videoVo.focus;

                    VUserId=videoUserId;

                    $("#videoPraiseNumber").text(video.praiseNumber);
                    $("#videoCollectionNumber").text(video.collectNumber);
                    $("#introduce").text(video.simpleIntroduce);

                    showVideoAndBullet(video.videoSrc, video.id, video.typeId);
                    var flag = ifFocusExist(videoUserId)
                    showUserInfo(videoVo.userName, videoVo.icon, videoVo.type, video.upTime, focus, flag, videoUserId);
                    getVideoComment(video.id, 1, 1);
                    getTheSameVideo(videoUserId, video.typeId);
                }
            }

        })
    }


    //展示用户信息
    function showUserInfo(userName, icon, type, upTime, focus, flag, videoUserId) {
        $("#userInfo").empty();
        var appendhtml = '';
        appendhtml += '<img class="img-circle" src="..' + icon + '" alt="User Image">\n' +
            '                        <span class="username"><a href="#">' + userName + '</a>&nbsp;' +
            '                    <a href="/user/news.html?rId=' + videoUserId + '" class="dropdown-toggle">\n' +
            '                        <i class="fa fa-envelope-o"></i>\n' +
            '                        发消息\n' +
            '                    </a>\n';
        if (flag) {
            appendhtml += '<div id="focus"><button type="button" class="btn btn-default btn-sm" onclick="delFocus(' + videoUserId + ')"> 取消关注' + focus + '</button></div>';
        } else {
            appendhtml += '<div id="focus"><button type="button" class="btn btn-info btn-sm" onclick="addFocus(' + videoUserId + ')"><span class="fa fa-fw fa-plus"></span>关注' + focus + '</button></div>'
        }
        appendhtml += '</span>\n' +
            '                        <span class="description">' + type + '&nbsp;&nbsp;&nbsp;&nbsp;' + upTime + '</span>';
        $("#userInfo").append(appendhtml);
    }


    //发送评论
    function sendVideoComment(videoId) {

        var content = $("#usercontent").val();
        $.ajax({
            url: '/videoComment/addComment',
            type: 'post',
            data: {
                userId: userId,
                type: 1,
                videoId: videoId,
                content: content
            },
            success: function (data) {
                if (data.code == 0) {
                    swal('', '评论成功！', 'success');
                    getVideoComment(videoId, 1, 1);
                }
            }
        });
    }


    /**
     * 根据视频的上传者的id和类型得到相似的视频信息
     * @param userId
     * @param type
     */
    function getTheSameVideo(userId, type) {
        $.ajax({
            url: '/video/getTheSameVideo',
            type: 'get',
            data: {
                userId: userId,
                type: type
            },
            success: function (data) {
                if (data.code == 0) {
                    var info = data.data;
                    showTheSameInfo(info);
                }
            }
        })
    }


    //展示相同类型的视频信息
    function showTheSameInfo(data) {
        var appendhtml = '';
        $("#sameVideo").empty();
        for (var i = 0; i < data.length; i++) {
            var video = data[i].video;
            console.log(video);
            var id = video.id;
            appendhtml += ' <div class="info-box">\n' +
                '                    <div class="attachment-block clearfix">\n' +
                '                        <img style="width: 100px;height:56px" class="attachment-img" src="..' + video.firstImagePath + '" alt="Attachment Image">\n' +
                '\n' +
                '                        <div class="attachment-pushed">\n' +
                '                            <h4 class="attachment-heading"><a href="/user/video.html?videoId=' + id + '">' + video.simpleIntroduce + '</a></h4>\n' +
                '\n' +
                '                            <span class="username">\n' +
                '                                ' + data[i].userName + '\n' +
                '                            </span>\n' +
                '                            <!-- /.attachment-text -->\n' +
                '                        </div>\n' +
                '                        <!-- /.attachment-pushed -->\n' +
                '                    </div>\n' +
                '                    <!-- /.info-box-content -->\n' +
                '                </div>';

        }
        $("#sameVideo").append(appendhtml);
    }


    /**
     * 播放视频和弹幕
     * @param src
     * @param videoId
     * @param type
     */
    function showVideoAndBullet(src, videoId, type) {
        $("#danmup").DanmuPlayer({
            src: ".." + src,
            width: "800px",
            height: "450px",
            urlToGetDanmu: "/bulletScreen/get?videoId=" + videoId + "&type=" + type,
            urlToPostDanmu: "/bulletScreen/add"
        });
    }

    /**
     * 得到视频的评论和回复
     * @param videoId
     * @param type 番剧或视频
     */
    function getVideoComment(videoId, type, currPage) {
        $.ajax({
            url: '/videoComment/getComment',
            type: 'get',
            data: {
                videoId: videoId,
                type: type,
                currPage: currPage
            },
            success: function (data) {
                if (data.code == 0) {
                    var data = data.data;
                    showVideoComment(data, videoId);
                }
            }
        })
    };


    /**
     * 显示视频的评论信息
     * @param data
     */
    function showVideoComment(data, videoId) {

        $("#videoComment").empty();


        var appendhtml = '';
        var lists = data.lists;
        for (var i = 0; i < lists.length; i++) {
            var videoComment = lists[i].videoComment;
            appendhtml += '<div class="box-comment" id="' + videoComment.id + '">\n' +
                '                        <!-- User image -->\n' +
                '                        <img class="img-circle img-sm" src="..' + lists[i].icon + '" alt="User Image">\n' +
                '\n' +
                '                        <div class="comment-text">\n' +
                '                      <span class="username">\n' +
                '                        ' + lists[i].userName + '\n';

            if (ifPraise(videoComment.id)) {
                appendhtml += '<i id="praise' + videoComment.id + '" class="fa fa-thumbs-o-up pull-right colorflag" style="cursor: pointer" onclick="giveCommentPraise(' + videoComment.id + ',' + videoComment.userId + ')">' + videoComment.praiseNumber + '</i>';

            } else {
                appendhtml += '<i id="praise' + videoComment.id + '" class="fa fa-thumbs-o-up pull-right"  style="cursor: pointer" onclick="giveCommentPraise(' + videoComment.id + ',' + videoComment.userId + ')">' + videoComment.praiseNumber + '</i>';
            }
            appendhtml += '                        <span class="text-muted pull-right">' + videoComment.createTime + '</span>\n' +
                '                      </span><!-- /.username -->\n' +
                '                            ' + videoComment.content + '\n' +
                '                       <a class="" onclick="showCommentReplyInput(' + videoComment.id + ',\'' + videoComment.content + '\',' + videoComment.userId + ',\'' + lists[i].userName + '\')" style="cursor:pointer">回复</a>' +
                '                        <a class="pull-right" data-toggle="collapse" onclick="getCommentReply(' + videoComment.id + ')" href="#videoComment' + videoComment.id + '">查看回复</a>&nbsp;&nbsp;&nbsp;&nbsp;' +
                '                        </div>\n' +
                '                        <div id="videoComment' + videoComment.id + '" class="panel-collapse collapse">\n' +
                '                            </div>' +
                '                        <!-- /.comment-text -->\n' +
                '<div style="display: none" class="img-push" id="divinput' + videoComment.id + '">' +
                '<input id="input' + videoComment.id + '" type="text" class="form-control input-sm" placeholder="">' +
                '<input id="inputmycontent" type="hidden">' +
                '<input id="inputBeReplyId" type="hidden">' +
                '<button onclick="sendCommentReply(' + videoComment.id + ')">回复</button>' +
                '</div>' +
                '                    </div>';

        }
        $("#videoComment").append(appendhtml);
        getUserInfo(userId);
        commonPage(data, videoId, 1);
    }

    function ifPraise(commentId) {
        var flag;
        $.ajax({
            url: '/videoComment/ifPraised',
            type: 'get',
            async: false,
            data: {
                userId: userId,
                type: 3,
                opType: 1,
                commentId: commentId,
            },
            success: function (data) {
                if (data.code == 0) {
                    flag = data.data;
                }
            }

        });
        return flag;
    }


    /**
     *获得当前登录用户的用户信息
     */
    function getUserInfo(userId) {
        var result;
        $.ajax({
            url: '/user/getUserInfo',
            type: 'get',
            data: {
                userId: userId
            },
            success: function (data) {
                if (data.code == 0) {
                    result = data.data;
                    showInput(result);
                }
            }
        });
    };

    /**
     * 展示评论输入框
     * @param data
     */
    function showInput(data) {
        $("#inputComment").empty();
        var appendInput = '<form action="#" method="post">\n' +
            '                        <img class="img-responsive img-circle img-sm" src="..' + data.icon + '"\n' +
            '                             alt="Alt Text">\n' +
            '                        <!-- .img-push is used to add margin to elements next to floating images -->\n' +
            '                        <div class="input-group margin">\n' +
            '                            <input id="usercontent" type="text" class="form-control input-sm" placeholder="说点什么吧">\n' +
            '                            <span class="input-group-btn">' +
            '                              <button type="button" class="btn btn-info btn-flat" onclick="sendVideoComment(' + videoId + ')">发送</button>' +
            '                            </span>' +
            '                        </div>\n' +
            '                    </form>';
        $("#inputComment").append(appendInput);
    }


    //得到评论下的回复
    function getCommentReply(commentId) {
        $.ajax({
            url: '/commentReply/get',
            type: 'get',
            data: {
                commentId: commentId
            },
            success: function (data) {
                var data = data.data;
                showCommentReply(data, commentId);
            }
        })
    }

    //展示评论下的回复
    function showCommentReply(data, id) {
        $("#videoComment" + id).empty();
        var appendhtml = '';
        if (data.length == 0) {
            appendhtml += '无回复';
        }
        for (var i = 0; i < data.length; i++) {

            var commentReply = data[i].commentReply;
            appendhtml += '<div class="panel-body">';
            appendhtml += '<div class="box-comment">\n' +
                '                        <!-- User image -->\n' +
                '                        <img class="img-circle img-sm" src="..' + data[i].icon + '" alt="User Image">\n' +
                '\n' +
                '                        <div class="comment-text">\n' +
                '                      <span class="username">\n' +
                '                        ' + data[i].userName + '&nbsp;&nbsp;回复\n' + data[i].beUserName +
                '                        <span class="text-muted pull-right">' + changeDateFormat(commentReply.replyTime) + '</span>\n' +
                '                      </span><!-- /.username -->\n' +
                '                            ' + commentReply.content + '\n' +
                '                       <a class="" onclick="showCommentReplyInput(' + commentReply.commentId + ',\'' + commentReply.content + '\',' + commentReply.replyId + ',\'' + data[i].userName + '\')" style="cursor:pointer">回复</a>' +
                '                        </div>\n' +
                '                        <!-- /.comment-text -->\n' +
                '                    </div>';
            appendhtml += '</div>';
        }
        $("#videoComment" + id).append(appendhtml);
    }

    function showCommentReplyInput(inputid, myContent, beReplyId, beReplyName) {
        var inputId = 'divinput' + inputid;

        var tempBeReplyId = $("#inputBeReplyId").val();
        var inputId2 = 'input' + inputid;
        if (tempBeReplyId == beReplyId) {
            $("#" + inputId).fadeToggle("slow");
        }
        $("#inputmycontent").val(myContent);
        $("#inputBeReplyId").val(beReplyId);
        $("#" + inputId2).attr("placeholder", "回复：@" + beReplyName);


    };


    /**
     * 给评论点赞
     * @param commentId
     */

    function giveCommentPraise(commentId, beUserId) {
        var json = {"userId": userId, "type": 3, "opType": 1, "commentId": commentId, "beUserId": beUserId};
        var needid = 'praise' + commentId;

        var number = Number($("#" + needid).text());
        $.ajax({
            url: '/videoComment/givePraise',
            type: 'patch',
            data: JSON.stringify(json),
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    if (data.data == "del") {
                        $("#" + needid).text(number - 1);
                        $("#" + needid).removeClass('colorflag');
                    } else if (data.data == "add") {
                        $("#" + needid).text(number + 1);
                        $("#" + needid).addClass('colorflag');
                    }
                }
            }

        })
    };


    /**
     * 给视频点赞
     *
     */

    function giveVideoPraise() {
        var json = {"userId": userId, "type": 1, "opType": 1, "videoId": videoId, "beUserId": VUserId};

        var number = Number($("#videoPraiseNumber").text());
        $.ajax({
            url: '/video/givePraise',
            type: 'patch',
            data: JSON.stringify(json),
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    if (data.data == "del") {
                        $("#videoPraiseNumber").text(number-1);
                    } else if (data.data == "add") {
                        $("#videoPraiseNumber").text(number+1);
                    }
                }
            }

        })
    }


    /**
     * 分享视频
     */
    function giveVideoShare() {
        var json = {"userId": videoUserId, "fansId": userId};
        $.ajax({
            url: '/video/givePraise',
            type: 'patch',
            data: JSON.stringify(json),
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    if (data.data) {

                    }

                }
            }

        })
    }


    /**
     * 收藏视频
     *
     */
    function giveVideoCollection() {
        var json = {"userId": userId, "type": 1, "opType": 2, "videoId": videoId, "beUserId": VUserId};

        var number = Number($("#videoCollectionNumber").text());
        $.ajax({
            url: '/video/giveCollection',
            type: 'patch',
            data: JSON.stringify(json),
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    if (data.data == "del") {
                        $("#videoCollectionNumber").text(number-1);
                    } else if (data.data == "add") {
                        $("#videoCollectionNumber").text(number+1);
                    }

                }
            }

        })
    }

    /**
     *发送回复消息
     */
    function sendCommentReply(id) {
        var content = $("#input" + id).val();
        $("#input" + id).val('');
        var myContent = $("#inputmycontent").val();
        var beReplyId = $("#inputBeReplyId").val();
        $.ajax({
            url: '/commentReply/add',
            type: 'post',
            data: {
                content: content,
                replyId: userId,
                beReplyId: beReplyId,
                commentId: id,
                myContent: myContent
            },
            success: function (data) {
                if (data.code == 0) {
                    swal('', '回复成功', 'success');

                }
            }
        })
    }


    /**
     * 对上传视频者进行关注
     * @param videoUserId
     */
    function addFocus(videoUserId) {

        $.ajax({
            url: '/focus/addFocus',
            type: 'post',
            data: {
                userId: videoUserId,//视频上传者的id
                fansId: userId     //用户的id
            },
            success: function (data) {
                if (data.code == 0) {
                    var data = data.data;
                    if (data) {
                        swal('', '关注成功！', 'success');
                        var focus = getFocusNumber(videoUserId);
                        $("#focus").empty();
                        $("#focus").append('<button type="button" class="btn btn-default btn-sm" onclick="delFocus(' + videoUserId + ')"> 取消关注' + focus + '</button>');
                    }
                }
            }
        })
    }

    /**
     * 得到关注的数量
     */
    function getFocusNumber(userId) {
        var number;
        $.ajax({
            url: '/focus/getNumber',
            type: 'get',
            data: {
                userId: userId
            },
            async: false,
            success: function (data) {
                if (data.code == 0) {
                    number = data.data;
                }
            }
        });
        return number;
    }

    /**
     * 取消对某个用户的关注
     * @param videoUserId
     */
    function delFocus(videoUserId) {

        var json = {"userId": videoUserId, "fansId": userId};
        $.ajax({
            url: '/focus/delFocus',
            type: 'delete',
            data: JSON.stringify(json),
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    var data = data.data;
                    if (data) {
                        var focus = getFocusNumber(videoUserId);
                        $("#focus").empty();
                        $("#focus").append('<button type="button" class="btn btn-info btn-sm" onclick="addFocus(' + videoUserId + ')"><span class="fa fa-fw fa-plus"></span>关注' + focus + '</button>');

                    }
                }
            }
        });

    }

    /**
     * 判断该用户是否已关注视频作者
     * @param videoUserId
     */
    function ifFocusExist(videoUserId) {
        var flag;
        $.ajax({
            url: '/focus/ifExist',
            type: 'get',
            async: false,
            data: {
                userId: videoUserId,//视频上传者的id
                fansId: userId     //用户的id
            },
            success: function (data) {
                if (data.code == 0) {
                    flag = data.data;

                }
            }
        });
        return flag;
    }
</script>
</body>
</html>